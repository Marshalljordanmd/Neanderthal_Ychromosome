#to make a vcf file from the 3 files of the Allen dataset
#1."Allen_Y_32670lines.geno", 2. "Allen_Y_positions.csv", 3. ancient males from 'v52.2_1240K_public.txt'
#below the example of a vcf file
#CHROM	POS	ID	REF	ALT	QUAL	FILTER	INFO	FORMAT	....(genotypes)..................


import pandas as pd
import os



if os.path.exists('Allen_select_32670_SNP.vcf'):
	os.remove('Allen_select_32670_SNP.vcf')






file1 = 'Allen_Y_positions.csv'
df1 = pd.read_csv(file1,sep='\t',header=None)
print(df1)
rws1 = df1.shape[0]
print('number of rows = ',rws1)
pos = df1.iloc[:,3]
ids = df1.iloc[:,0]
ref = df1.iloc[:,4]
alt = df1.iloc[:,5]


#below the 946 position indices of the Allen_Y_positions.csv representing patriarch snps
#Allen_position_indices = [35, 88, 89, 113, 125, 172, 198, 222, 232, 243, 247, 264, 273, 309, 404, 420, 450, 514, 592, 646, 690, 1580, 1725, 1816, 1873, 1904, 1922, 1942, 2003, 2036, 2235, 2312, 2341, 2355, 2365, 2376, 2383, 2424, 2515, 2521, 2607, 2610, 2653, 2658, 2703, 2745, 2755, 2832, 2897, 2945, 2964, 2971, 2977, 2983, 3017, 3049, 3063, 3069, 3097, 3100, 3109, 3138, 3151, 3175, 3185, 3189, 3209, 3211, 3242, 3259, 3287, 3288, 3290, 3425, 3445, 3469, 3495, 3498, 3499, 3523, 3535, 3536, 3540, 3556, 3596, 3619, 3641, 3660, 3686, 3694, 3710, 3767, 3816, 3871, 3903, 3971, 3975, 3990, 4003, 4053, 4058, 4060, 4106, 4167, 4176, 4182, 4188, 4191, 4201, 4249, 4281, 4322, 4353, 4422, 4435, 4436, 4444, 4458, 4459, 4515, 4589, 4654, 4711, 4821, 4836, 4847, 4869, 4882, 4886, 4952, 4988, 4999, 5007, 5099, 5123, 5135, 5164, 5187, 5195, 5215, 5228, 5241, 5258, 5275, 5319, 5348, 5353, 5371, 5388, 5441, 5472, 5504, 5522, 5531, 5539, 5560, 5640, 5647, 5673, 5725, 5730, 5775, 5777, 5877, 5902, 5935, 5942, 5982, 5997, 6001, 6065, 6071, 6078, 6096, 6105, 6119, 6134, 6147, 6185, 6211, 6233, 6347, 6381, 6469, 6485, 6509, 6571, 6594, 6622, 6686, 6696, 6833, 6836, 6898, 6940, 6951, 6967, 7060, 7066, 7137, 7141, 7142, 7190, 7209, 7237, 7257, 7265, 7280, 7286, 7287, 7291, 7308, 7328, 7336, 7341, 7349, 7417, 7434, 7436, 7505, 7525, 7536, 7565, 7591, 7615, 7653, 7656, 7657, 7708, 7727, 7746, 7812, 7845, 7853, 7872, 7884, 7934, 7961, 7974, 7980, 7992, 8031, 8251, 8259, 8343, 8440, 8449, 9146, 9189, 9690, 10600, 10749, 10826, 10848, 10886, 10904, 10953, 10972, 11032, 11044, 11059, 11077, 11087, 11107, 11119, 11135, 11151, 11155, 11175, 11176, 11209, 11238, 11241, 11254, 11264, 11331, 11354, 11385, 11386, 11402, 11456, 11515, 11541, 11595, 11629, 11641, 11654, 11668, 11675, 11680, 11735, 11742, 11757, 11805, 11810, 11816, 11817, 11872, 11899, 11974, 11991, 12051, 12057, 12133, 12205, 12217, 12295, 12302, 12310, 12326, 12342, 12352, 12407, 12436, 12467, 12501, 12506, 12571, 12642, 12644, 12658, 12674, 12685, 12703, 12800, 12824, 12841, 12868, 13175, 13184, 13213, 13241, 13296, 13311, 13337, 13390, 13395, 13426, 13431, 13443, 13527, 13540, 13543, 13619, 13668, 13721, 13723, 13771, 13776, 13873, 13880, 13925, 13930, 13950, 14039, 14080, 14101, 14178, 14273, 14284, 14304, 14305, 14315, 14331, 14339, 14373, 14394, 14426, 14452, 14469, 14490, 14496, 14516, 14522, 14562, 14574, 14605, 14626, 14629, 14649, 14664, 14679, 14697, 14725, 14729, 14735, 14773, 14776, 14789, 14868, 14890, 14948, 14971, 15076, 15088, 15098, 15145, 15159, 15221, 15264, 15267, 15299, 15301, 15310, 15366, 15383, 15392, 15429, 15436, 15455, 15457, 15482, 15577, 15590, 15622, 15631, 15665, 15716, 15721, 15730, 15773, 15845, 15861, 15903, 15921, 15949, 15979, 15981, 15985, 15994, 16003, 16010, 16020, 16118, 16210, 16260, 16284, 16289, 16304, 16332, 16335, 16361, 16389, 16390, 16415, 16445, 16447, 16452, 16456, 16481, 16485, 16540, 16557, 16567, 16610, 16632, 16655, 16663, 16702, 16743, 16759, 16841, 16860, 16960, 16969, 16975, 16996, 17028, 17046, 17048, 17105, 17152, 17196, 17211, 17251, 17284, 17310, 17380, 17470, 17510, 17550, 17567, 17598, 17616, 17635, 17671, 17674, 17679, 17758, 17805, 17851, 17861, 17928, 17952, 18006, 18016, 18019, 18034, 18067, 18089, 18094, 18193, 18207, 18234, 18266, 18309, 18323, 18329, 18334, 18337, 18341, 18467, 18498, 18512, 18517, 18529, 18544, 18557, 18601, 18629, 18652, 18660, 18784, 18813, 18819, 18821, 18830, 18849, 18865, 18890, 18902, 18926, 18984, 19005, 19019, 19054, 19068, 19079, 19082, 19107, 19142, 19212, 19252, 19258, 19268, 19321, 19334, 19346, 19348, 19354, 19361, 19380, 19399, 19413, 19475, 19528, 19634, 19680, 19701, 19707, 19729, 19752, 19768, 19827, 19899, 19928, 19931, 19950, 20004, 20007, 20036, 20059, 20133, 20191, 20195, 20199, 20216, 20259, 20285, 20336, 20355, 20360, 20365, 20367, 20395, 20418, 20531, 20551, 20595, 20655, 20690, 20722, 20788, 20819, 20844, 20856, 20862, 20920, 20947, 20984, 21047, 21062, 21082, 21086, 21087, 21115, 21132, 21155, 21158, 21163, 21165, 21171, 21222, 21231, 21274, 21329, 21404, 21474, 21487, 21515, 21560, 21576, 21613, 21659, 21665, 21748, 21771, 21784, 21802, 21805, 21817, 21820, 21825, 21847, 21879, 21915, 21921, 21927, 21962, 21970, 22023, 22042, 22136, 22194, 22213, 22290, 22293, 22296, 22306, 22315, 22318, 22320, 22330, 22331, 22418, 22433, 22447, 22562, 22571, 22611, 22662, 22685, 22693, 22720, 22805, 22811, 22812, 22864, 22880, 22918, 22926, 23062, 23064, 23086, 23088, 23130, 23165, 23172, 23239, 23325, 23388, 23408, 23415, 23498, 23509, 23521, 23531, 23588, 23629, 23639, 23641, 23666, 23704, 23725, 23729, 23733, 23864, 23908, 23924, 23967, 23969, 23995, 24029, 24057, 24086, 24114, 24121, 24140, 24173, 24176, 24190, 24204, 24245, 24246, 24250, 24258, 24260, 24279, 24323, 24397, 24398, 24419, 24518, 24540, 24606, 24621, 24668, 24671, 24709, 24711, 24737, 24761, 24784, 24789, 24791, 24807, 24816, 24827, 24856, 24904, 24909, 24940, 24969, 24993, 24994, 25026, 25056, 25073, 25075, 25108, 25199, 25217, 25249, 25260, 25265, 25275, 25279, 25381, 25410, 25437, 25497, 25549, 25588, 25606, 25608, 25612, 25615, 25639, 25653, 25724, 25770, 25773, 25782, 25808, 25816, 25817, 25821, 25883, 25887, 25889, 25890, 25923, 25989, 26007, 26019, 26067, 26246, 26256, 26289, 26333, 26339, 26348, 26391, 26402, 26404, 26415, 26418, 26421, 26445, 26493, 26515, 26517, 26594, 26608, 26638, 26641, 26655, 26695, 26757, 26776, 26808, 26856, 26899, 26982, 26998, 27010, 27023, 27062, 27094, 27096, 27133, 27135, 27219, 27275, 27278, 27309, 27424, 27462, 27472, 27512, 27513, 27521, 27533, 27579, 27633, 27647, 27667, 27698, 27706, 27809, 27922, 27938, 28023, 28040, 28163, 28178, 28196, 28221, 28757, 28915, 29138, 29150, 29190, 29192, 29196, 29215, 29238, 29241, 29255, 29275, 29276, 29308, 29330, 29375, 29379, 29454, 29525, 29552, 29568, 29569, 29572, 29609, 29672, 29737, 29770, 29788, 29854, 29877, 29886, 29908, 29932, 29954, 29980, 30005, 30025, 30051, 30052, 30097, 30106, 30108, 30129, 30167, 30174, 30204, 30280, 30360, 30375, 30523, 30524, 30531, 30554, 30563, 30599, 30646, 30669, 30689, 30715, 30720, 30726, 30744, 30753, 30791, 30835, 30838, 30939, 30965, 30969, 31027, 31071, 31074, 31118, 31121, 31144, 31170, 31171, 31205, 31233, 31281, 31364, 31397, 31433, 31459, 31488, 31524, 31533, 31570, 31578, 31636, 31706, 31744, 31779, 31789, 31802, 31825, 32010, 32362]

#46 samples with count >= 900 = [677, 779, 1140, 2945, 3226, 3227, 3541, 3706, 4772, 4781, 4782, 4784, 4785, 4820, 5023, 5288, 5317, 5318, 6228, 6270, 6611, 6933, 8588, 8589, 8591, 8615, 9095, 9118, 9180, 9530, 9725, 10203, 10470, 11021, 11024, 11238, 11239, 11368, 11528, 11984, 12405]
geno_samples = [677, 779, 1140, 2945, 3227, 3541, 3706, 4820, 5288, 5317, 5318, 6270, 6933, 8588, 8589, 8591, 8614, 8615, 8839, 9095, 9118, 9180, 11021, 11368, 11984]




# file below is a string of numbers in 32670 lines
file = 'Allen_Y_32670lines.geno'  #this is made from the last 32670 lines of the 'v52.2_1240K_public_estratForJM.geno' file of the Allen aDNA Resources dataset

n = 0

with open('Allen_select_32670_SNP.vcf','a') as rl:  #CHROM	POS	ID	REF	ALT	QUAL	FILTER	INFO	FORMAT	....(genotypes)..................
	rl.write('CHROM	POS	ID	REF	ALT	QUAL	FILTER	INFO	FORMAT	Sumidouro5_689_10372.0_Brazil_Q1b1a1a	I10871_793_7913.0_Cameroon_..	A460_1154_5130.0_Chile_Q1b1a1a	I6750_2962_5650.0_United Kingdom_I2a1b1a1a1b	I5950_3244_4470.0_Ethiopia_E1b1a2b2~	2HC51961131_3558_5161.0_France_I2a1b1b	SATP_3725_13282.0_Georgia_J1	I1495_4841_6367.0_Hungary_I2a1a1b	rath2_5311_3819.0_Ireland_R1b1a1b1a1a2c1a5c	JP14_5340_5483.0_Ireland_HIJK	ANN1_5341_5405.0_Ireland_I2a1b1a1a1b	I11541_6296_3684.0_Kazakhstan_R1a1a1b2a2	Ma912_6968_2459.0_Malaysia_O1b1a1a1	I6714_8633_4479.0_Russia_Q1b2a1a~	I3949_8634_4569.0_Russia_Q1b	I3949_8636_4569.0_Russia_Q1b2a1a~	irk025_8659_4350.0_Russia_Q1b1b~	irk036_8660_4720.0_Russia_Q1b1b~	irk068_8884_4468.0_Russia_Q1b1b~	Sunghir4_9140_34323.0_Russia_C1a2	I1526_9163_4779.0_Russia_Q1b1b~	Yana2_9225_31850.0_Russia_P1~	Bar31_11076_8272.0_Turkey_G2a	AHUR770c_11423_10988.0_USA_Q1b1a1a	KS20_KS25.SG_12039_2351.0_Nepal_O2a2b1a1a1a4a1')	
	
	rl.write('\n')
	with open(file,'r') as rf:

		for k in range(rws1):  #there are 32670 lines in file2
		
			if n == 1000:
				print('k = ',k)
				n = 0
				
			n += 1
			
			line = rf.readline()
			#A_indx = k+1
			#if A_indx in Allen_position_indices:
				
			line = line.strip() #get rid of linefeed at end of string
			genos = [x for x in line] #list comprehension to put characters from string into list
			
			#if k > 32522:	
	
			rl.write('Y')  #chromosome
			rl.write('\t')
			rl.write(str(pos[k])) #GRCh37 position on Y chromosome
			rl.write('\t')
			rl.write(str(ids[k])) #name of SNP
			rl.write('\t')
			rl.write(str(ref[k])) #reference allele
			rl.write('\t')
			rl.write(str(alt[k])) #alternate allele
			rl.write('\t')

			rl.write('.') #QUAL
			rl.write('\t')
			rl.write('.') #FILTER
			rl.write('\t')
			rl.write('.')  #INFO
			rl.write('\t')
			rl.write('GT=0/1')  #genotype format
			rl.write('\t')		

			for m in geno_samples: 
		
				m_gt = genos[m-1]
				if m_gt == '0':
					gn = '0'
				elif m_gt == '2':
					gn = '1'
				else:
					gn = '.'

				rl.write(gn)
				if m < 11984: #last m in list
					rl.write('\t')


			rl.write('\n')
	
print('The file is done')
	




# 41 samples indices with count >= 900 = [677, 779, 1140, 2945, 3226, 3227, 3541, 3706, 4772, 4781, 4782, 4784, 4785, 4820, 5023, 5288, 5317, 5318, 6228, 6270, 6611, 6933, 8588, 8589, 8591, 8615, 9095, 9118, 9180, 9530, 9725, 10203, 10470, 11021, 11024, 11238, 11239, 11368, 11528, 11984, 12405]

#28 samples with count >= 920 = [779, 1140, 3227, 4772, 4781, 4782, 4784, 4785, 4820, 5023, 5317, 5318, 6228, 6270, 6611, 6933, 8588, 8589, 9118, 9180, 9530, 10470, 11238, 11239, 11368, 11528, 11984, 12405]





